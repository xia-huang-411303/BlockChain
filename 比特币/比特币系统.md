# 比特币系统
比特币系统是区块链系统的第一个典型应用，也是为比特币这个加密数字货币设计的专用系统，此处对其一些较为独特的特性，如UTXO模型、锁定脚本和解锁脚本等进行介绍。

## 比特币UTXO模型

首先，比特币系统中是没有严格意义上的“账户”概念的，取而代之，比特币系统提出了其独特的未消费的交易输出（Unspent Transaction Output，UTXO）模型，本书中简称UTXO模型。UTXO是一个包含交易数据和对应执行代码的数据结构，所有的UTXO条目构成了比特币的“账本”，其中每个传统意义上的“账户”的数据可以通过与它相关的UTXO推算出来。

在一个具有传统“账户”概念的传统支付系统中，每个用户都对应着一个账户，支付系统会对每个账户的余额进行单独的记录和管理。当系统中有用户之间发起了支付的交易，支付系统会分别对参与交易的账户的余额信息进行检查和修改。例如，A向B转账50元，首先需要检查A的账户中有50元的余额，再同时从A的账户中扣除50元，并向B的账户中添加50元。

可以看到，为了保证整个系统的正确性，防止双花等情况的存在，支付系统需要确保对应的业务规则得到遵守（A的账户中至少有50元的余额），同时也需要保证每个交易的“事务性”，即原子性、一致性、隔离性及持久性（[[ACID]]），简单来说，即保证从A的账户扣款和向B的账户添加款项这两个动作必须同时执行，不受其他事件影响，且不会丢失。

然而，比特币系统并没有采取如此的设计，而是创新性地提出了UTXO的方案。UTXO方案的核心就在于，通过交易本身来构成系统账本，而不是通过账户信息构成账本。具体来说，在比特币的每一笔交易（TX）中，都有“交易输入”（资产来源）和“交易输出”（资产去向），且每个交易都可以有多个交易输入和多个交易输出，交易之间按照时间戳的先后顺序排列，且任何一个交易中的交易输入都是其前序的某个交易中产生的“未花费交易输出”，而所有交易的最初的交易输入都来自coinbase交易，即矿工得到的挖矿奖励。

我们给出[[UTXO模型下的转账过程的例子|一个例子]]来说明UTXO模型下的转账过程。从例子可以看出，比特币系统中，实际上不存在明显的“账户余额”的概念。每个账户都对应着某个地址，而某个地址在某个时间点所具有的“余额”，是需要通过他具有的UTXO的情况进行计算得出的。在比特币系统中，这种跟踪计算由比特币钱包代为负责。

基于如此设计的UTXO系统，比特币如何保证UTXO只能被对应的地址所引用为交易输入呢？答案是比特币的脚本特性。比特币支持较为简单的交易脚本编写，用于对相应资产使用方式的规则的制定。

## 锁定脚本与解锁脚本

比特币系统中，交易的合法性验证依赖于两类脚本，即锁定脚本与解锁脚本。实际上，比特币的交易过程中，要在交易输入中提供一个用于解锁UTXO的脚本，这类脚本即“解锁脚本”，是一类能够“解决”所引用的交易输出上设定的花费条件的脚本；同时，交易的输出需要指向一个用于锁定当前交易的交易输出的脚本，这类脚本即“锁定脚本”，该脚本的意义在于，在后续的交易中，谁能够提供与该锁定脚本匹配的解锁脚本，就能够使用该脚本所锁定的UTXO输出。交易的验证过程中，每个节点会通过执行当前交易的解锁脚本和当前交易所引用的上一个交易的锁定脚本来对交易进行验证，当两个脚本匹配时，交易才会被验证为有效。

比特币的交易脚本是一种基于[[逆波兰表示法]]的基于[[堆栈]]的执行语言。比特币交易脚本的语言即采用逆波兰表达式的执行流程，并对与交易相关的一些操作符进行了规定。在编写的过程中，用户可以通过选取相应的操作符并填入相关的操作数来进行脚本的编写。

需要说明的是，比特币所使用的脚本语言，具有图灵非完备性及执行结果确定的两种性质。
其中，图灵非完备性对应着英国数学家图灵所提出的抽象计算模型：确定性图灵机，它是一个能够计算任何可计算函数的、具有无限存储能力的计算机器；若一个语言能够用图灵机做到的所有事情，则称该语言为“图灵完备”的。然而，由于比特币的交易脚本语言不支持循环或者较为复杂的流控制，所以它是图灵非完备的。
换句话说，比特币的交易脚本的表达能力是极为有限的，其执行的流程、循环的次数都是可以预见的且确定的。然而，就是这种受限性所带来的确定性，保证了比特币的安全性。由于交易脚本语言的确定性，保证了相同的脚本在所有节点上的执行结果都是一致的，因此，一个有效的（可以通过验证的）交易在所有节点上都是有效的。相对于后期的一些支持非确定性的高级编程语言的智能合约平台，比特币在这一方面的安全性是十分可靠的。

另一方面，为了进一步保证比特币的安全性，比特币开发者对客户端可以操作的脚本类型进行了限制，规定了客户端可运行的五种[[标准交易脚本]]，分别为P2PKH、P2PK、P2SH、MS和OP_Return，对应着不同的特性和用处。

可以说，比特币系统作为区块链领域的开山之作，其中各种设计都是非常精巧且值得借鉴的。当前，比特币已经走过了十多年，除部分交易所因为自身防范不周曾发生过被黑客盗取储备币等问题，目前还没有因为比特币自身的机制产生过严重的安全问题，同时，比特币系统的各种设计仍被各类区块链系统广为借鉴和拓展。

## 比特币的隐私模型

传统的交易系统为交易的参与者提供了一定程度的隐私保护。具体地，用户需要将交易信息和个人身份信息递交给可信任的第三方，由可信任的第三方对用户信息和交易信息进行维护和保护。这种方案具有一定的安全性，因为可信任的第三方通常会采取一些方式对自己保存的用户信息和交易信息进行保密。然而，可信任的第三方也不是完全安全的，它可能会被攻击者攻破，也存在因为某些利益原因主动将部分数据交由其他人进行处理和分析的风险。
在比特币系统中，由于所有的交易都会被广播至全网，所以传统的中心化的隐私保护方法均不适用。然而，由于比特币的独特设计，用户的隐私依然可以得到保护。

比特币系统中不存在“账户”，其账本是由一个个交易组成的，而交易中的参与者仅是一系列“地址”，或者说是公钥。公众所能够从公开的账本中得知的信息仅仅是某些地址将一定数量的货币发送给了另一些地址，然而，对于具体的地址与人的对应关系却一无所知。作为额外的防护措施，比特币的使用者甚至可以在每次交易中都产生并使用一个新的地址，从而使交易的追溯更加困难。从比特币被发明到现在的十多年间，中本聪作为发明者和较大量的比特币持有者，其真实身份一直未被大众所获知，也可以从一定程度上说明比特币的隐私保护功能的强大。

然而需要指明的是，比特币系统虽然可以通过地址和用户不对应的方式对用户隐私进行保护，但其账本完全公开的特性，也给所有人提供了分析账本数据，找出特定地址交易规律，从而定位地址与人的对应关系的可能。

