区块链系统是一个高度去中心化的系统，各节点需要维护相同的账本数据。但在现实网络环境中，节点数据的一致性面对诸多威胁：网络消息可能存在阻塞、丢包或重传，节点运行可能宕机或错误，同时系统面临“[[女巫攻击]]”“[[双花攻击]]”等潜在风险。如何在如此复杂的网络环境中保证各节点数据的一致性，是共识算法需要解决的主要问题。

共识层是区块链系统的核心，主要封装了区块链节点间协同运行的各类[[共识算法]]，并利用这些共识算法实现高安全性、去中心化、去信任化等特性。
首先，共识算法需具备高安全性，即使在存在节点崩溃甚至恶意攻击风险的网络中，仍然需要确保正常节点之间就特定数据达成一致；
其次，共识算法是去中心化的，支持多个节点组成分布式共识集群，共同参与交易的验证与执行，无须依赖中心化的第三方就能正常运转；
最后，共识算法是去信任化的，共识节点之间并不需要彼此信任，而是只要参与共同的共识机制，就能最终达成对账本的一致认知。

共识层承担着保障分布式节点对特定交易达成一致的使命，为此，共识层需要承担交易验证、排序，区块生成、验证的功能。
区块链系统运行时，会收到来自多个客户端的交易请求，共识层首先要对海量交易安排确定的执行顺序，确保任意节点都能按相同顺序执行交易。同时，为了提高共识效率，通常共识层会将一批交易数据进行打包，从而批量进行共识，一批打包好的交易数据会被存储到区块结构中，在共识集群内广播。当其他共识层节点收到区块后，需要对区块的合法性与其中众多交易的合法性进行独立验证，对于验证不合法的区块或交易，节点有权拒绝执行，以抵御可能存在的恶意攻击；如果区块与交易在该节点校验通过，共识层会按指定的交易顺序请求合约层对交易进行执行，并将执行结果发送到数据层，发起数据更新的请求，最终会由数据层完成交易结果的持久化。

一般而言，为了降低系统的复杂度，共识过程中通常会由特定节点承担交易排序与区块生成的职能，这些特定节点往往被称为“记账节点”或“出块节点”。这些特定节点可能由竞争、投票、随机指定等不同策略产生，而这些策略往往正是决定区块链共识层执行效率、公平性乃至安全性的核心。

在进行共识层的设计时，
首先需要重点考虑的是共识协议的选择。
当前业界的共识协议种类繁多，在安全假设、性能和可扩展性等方面各有侧重。
例如，在公有链场景中，由于节点可自由加入、退出，无须进行身份认证，因此共识算法大多是以证明类的算法为主，共识的效率较低，共识结果往往是非确定性的，为了吸引节点参与网络交易的见证，通常还会设置激励机制。
而在联盟链的场景中，以多中心化的应用场景为主，因此在共识算法的选择上更加关注性能，通常选择经典分布式共识中的拜占庭容错共识算法，但在共识节点的扩展性方面则不那么友好。

其次，为了实现区块链系统的可持续演进，良好的工程设计非常重要。
例如，为提升系统的可维护性，可以考虑组件化设计，共识协议与区块链系统松耦合，进而实现共识协议的插拔式替换。
